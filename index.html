
<html>

<head>
  <title>Ruby Works</title>

  <link REL="SHORTCUT ICON" HREF="assets/images/ruby_1.jpg" />

  <style>
    body  { font-family: arial; font-size: 11pt; margin: 0; padding: 0; background: url(assets/images/bg.jpg) 0 -10px repeat-x #dfdfff; }

       a  { text-decoration: none; }

       a:hover  { text-decoration: underline; }

     img  { border: none; }

      li  { font-family: monospace; font-size: 10pt; padding-bottom: 30px; }

     .nav { font-family: arial;  height: 365px; border-left: 1px solid #ccc; border-right: 1px solid #ccc; }

     .nav a { font-size: 18px; font-weight: bold; line-height: 36px; padding: 0 6px; text-decoration: none; }

   .links a { color: #aaa; font-size: 0.9em; }

   .title { font-family: arial; color: red; font-size: 28pt; height: 64px; background: url(assets/images/ruby_1.jpg) no-repeat; padding-left: 64px; }

   .title a { text-decoration: none; font-family: arial; color: red; font-size: 28pt; height: 64px; }

   .title .date { font-size: 20pt; }

   .footer { font-size: 10px; border-top: 1px solid #ccc; color: #999; }
  </style>
</head>

<body>

<div style="margin: 0 auto; width: 960px;">

<!-- Title -->
<div class="nav" style="background: url(assets/images/serpent.jpg) no-repeat; padding-left: 300px;">

  <div style="font-family: arial; font-size: 32pt; color: #ee0022;">
    <br/>
    <b>Ruby Works</b> <br/>
    <a href="index.html">Blog.read</a>
    <a href="projects.html">Self.inspect</a>
    <a href="rubynew.html">Ruby.new</a>
    <a href="http://github.com/rubyworks/">Github.com</a>
  </div>
   
  <div style="margin-top: 40px;">
    <FORM method="GET" action="http://www.google.com/groups" target="_blank">
    <!-- Search Google -->
    <A HREF="http://www.google.com/">
    <IMG SRC="http://www.google.com/logos/Logo_25wht.gif" border="0" ALT="Google" align="absmiddle"></A>
    <INPUT TYPE="text" name="q" size="25" maxlength="255" value="">
    <input type="hidden" name="hl" value="en">
    <input type="hidden" name="group" value="comp.lang.ruby">
    <INPUT type="submit" name="btnG" VALUE="Search Ruby Talk">
    <!-- Search Google -->
    </FORM>
  </div>

</div>

<div style="padding: 20px; background: white;">


<div class="page">


  <div class="post">
    <div class="title">
      <span class="date" style="float: right; padding-top: 5px;">2009-09-30</span>
      <a href="2009/10/functor.html">Functor</a>
    </div>
    <div class="btext">
      <h1>Functor : Object :: Enumerator : Enumerable</h1>

<p>In Ruby 1.9, Enumerable methods return an Enumerator when no block is provided them. This makes it very convenient to chain methods in what is often called <em>fluid notation</em>. For example, rather than the usual +#each_with_index+, one can use:</p>

<div class="CodeRay">
  <div class="code"><pre>
  [<span style="color:#00D;font-weight:bold">1</span>,<span style="color:#00D;font-weight:bold">2</span>,<span style="color:#00D;font-weight:bold">3</span>].each.with_index{ |e, i| ... }

</pre></div>
</div>

<p>Plenty of other possibilities along these lines become possible. It's a very powerful technique.</p>

<p>In the same spirit, I think there is another class that could be used in much the same way for more general methods, namely what Ruby Facets calls a <em>Functor</em> --a function that acts on a function. Essentially, it is defined as:</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Functor</span>
    private(*instance_methods.select { |m| m !~ <span style="background-color:#fff0ff"><span style="color:#404">/</span><span style="color:#808">(^__|^binding$)</span><span style="color:#404">/</span></span> })
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(&amp;function)
      <span style="color:#33B">@function</span> = function
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">to_proc</span>
      <span style="color:#33B">@function</span>
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">method_missing</span>(op, *args, &amp;blk)
      <span style="color:#33B">@function</span>.call(op, *args, &amp;blk)
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>An interesting example of it's use if overriding +#instance_eval+ to return a functor when no block is provided.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Object</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">instance_eval</span>(*args, &amp;blk)
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">super</span> <span style="color:#080;font-weight:bold">if</span> blk <span style="color:#080;font-weight:bold">or</span> !args.empty?
      <span style="color:#33B">@_instance_eval</span> ||= <span style="color:#036;font-weight:bold">Functor</span>.new <span style="color:#080;font-weight:bold">do</span> |op, *a, &amp;b|
        fcall(op, *a, &amp;b)
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>Now we can call a single method via instance_eval using fluid notation instead of having to open a block.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#036;font-weight:bold">MyClass</span>.instance_eval.attr_accessor <span style="color:#A60">:x</span>

</pre></div>
</div>

<p>There are many other similar uses for Functors. Just as Enumerator opens up a great deal of convenience and conciseness for Enumerable methods, Functor can do the same for methods generally.</p>

    </div>
    <p><a href="2009/10/functor.html">Continue Reading</a></p>
    <!-- <small>Written by trans</small> -->
  </div>
  <br/>

  <div class="post">
    <div class="title">
      <span class="date" style="float: right; padding-top: 5px;">2009-08-24</span>
      <a href="2009/11/new-website.html">New Website</a>
    </div>
    <div class="btext">
      <h1>Further Proof that Ruby Works</h1>

<p>Recently I set out to migrate most of my work from Rubyforge to GitHub, in so doing I needed a umbrella account to place all these
wonderfully chewy morsals. In deliberating a name for the account I recollected the very first Ruby website I had ever created back
in 2002. It was called Ruby Works and hosted at http://transami.net/ruby. It has long been defunct, but it seems fitting to bring my
Ruby career to a close by coming full circle. And so Ruby Works was reborn.</p>

<p>In the process of this migration I made myself this nifty new blog built with <a href="http://proutils.github.com/brite">Brite</a>, my home grown
static website and weblog construction kit. Actually, it's more than just a "Ruby Works" name that I am revitializing. I'm reusing the
orginal stylesheet for that orginal site too (albeit well modifed at this point).</p>

<p>In any case, this website is dedicated to the many awesome Ruby projects I've had the privilege to develop and maintain over the years.
Combined with <a href="http://proutils.github.com">ProUtils</a> and <a href="http://death.rubyforge.org">Death</a> --my scrap projects, these cover my complete
works in the Rubydom. Most of the projects are in good working order. In fact, I've only let a couple non-useable projects into the
collection, in their case because I would like to get them working soon. All the rest good to go, some in relatviely perfect order,
others still a little rough around the edges, but all usable.</p>

<p>As time wears on I'll blog about these various projects here (now that I have this spiffy new blog). If you would like to discuss any
of these projects please hop over the the <a href="http://googlegroups.com/group/rubyworks-mailinglist">Google Group</a>. I setup the group
just for that purpose.</p>

    </div>
    <p><a href="2009/11/new-website.html">Continue Reading</a></p>
    <!-- <small>Written by trans</small> -->
  </div>
  <br/>

  <div class="post">
    <div class="title">
      <span class="date" style="float: right; padding-top: 5px;">2008-11-23</span>
      <a href="2008/11/hash-rekey.html">Facets Hash#rekey</a>
    </div>
    <div class="btext">
      <p>This is the first in a series of posts in which I plan to introduce my fellow Rubyists to the plethora or goodness that is <a href="http://facets.rubyforge.org">Ruby Facets</a>.</p>

<p>Ruby Facets has been in development for several years, starting out as a rather rag-tag collection general purpose Ruby scripts, and has evolved into the latest release, version 2.5.0, which has reached a nice level of maturity --getting pretty close, I suppose one could say, to that stately realm of "enterprise-ready".</p>

<p>Every few weeks or so, I'll pick a library or particular extension and expound upon it. While the main intent of this series is to let others know what Facets makes available to them. I will also use it as a platform to further improve and polish Facets. So please, feel free to comment, make suggestions and point out alternatives, so that Facets might better serve the Ruby community in the future.

Okay, now to the meat of this edition...

I decided to start with something quite simple, but very useful, homogenizing hash keys. Currently in Ruby, this requires code like:</p>


<div class="CodeRay">
  <div class="code"><pre>
  new_hash = {}
  old_hash.each <span style="color:#080;font-weight:bold">do</span> |k,v|
    k = k.to_sym
    new_hash[k] = v
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>Of course, that can be golfed-down a bit, but I wanted to spell it out for clarity. In this particular example, I converted all the keys to symbols (<code>to_sym</code>). Along with strings, that is one of the most commonly needed key conversions. Common enough in fact that Rails' ActiveSupport library provides <code>symbolize_keys</code> and an alias <code>#to_options</code>. It's also provides <code>stringify_keys</code>. Facets offers these methods too, since they are certainly so well known by now. However, Facets provides and recommends a more versatile method, <code>rekey</code>. With it the above example becomes as simple as:</p>

<div class="CodeRay">
  <div class="code"><pre>
  old_hash.rekey

</pre></div>
</div>

<p><code>Hash#rekey</code> actually takes a block, but if no block is given, as in the above, it defaults to symbol conversion. If we wanted to convert the keys to strings instead, the magic of Symbol#to_proc makes that as simple as:</p>

<div class="CodeRay">
  <div class="code"><pre>
  old_hash.rekey(&amp;<span style="color:#A60">:to_s</span>)

</pre></div>
</div>

<p>And lastly, of course, we could get crazy with it and make every key a "Turk".</p>

<div class="CodeRay">
  <div class="code"><pre>
  old_hash.rekey{ |k| <span style="color:#036;font-weight:bold">Turk</span>.new(k) }

</pre></div>
</div>

<p>I don't know about you, but I like turk-keys. Oh, the pun! It hurts! :)</p>

<p>Happy Thanksgiving.</p>

    </div>
    <p><a href="2008/11/hash-rekey.html">Continue Reading</a></p>
    <!-- <small>Written by trans</small> -->
  </div>
  <br/>

  <div class="post">
    <div class="title">
      <span class="date" style="float: right; padding-top: 5px;">2008-10-06</span>
      <a href="2008/10/hash.html">This Old Hash</a>
    </div>
    <div class="btext">
      <h1>This Old Hash</h1>

<p>The Hash may well be the most used class in Ruby. Sure, our programs
have arrays and strings galore, but they generally come and go without
much ado. Hashes on the other hand get <em>used</em>; and by that I mean to
say, we spend a lot of time fussing with them. I think there are two
significant reasons for this and I will focus on the first, and
the more important of the two, here.</p>

<p>Now, I suspect you would agree, if I were to present you with a class
which was clearly overkill for vast majority of its intended uses, and
its use required repeated mitigation of its unused features, I have no
doubt, you'd unequivocally advise me to select a "<i>better tool for the job</i>".
And yet, that's the situation all Ruby programmers face, day in and
day out, with Ruby's Hash.</p>

<p>Ruby's Hash is exceptionally powerful because it supports any type of
object as a hash key. That's really really cool... for all of about
five minutes. The truth is, the vast majority of cases only require
one type of key --for Ruby that will either be a Symbol or a String,
and because of this, a great deal of time and code is wasted ensuring
all keys are that single type. Because of this, methods like
<code>#to_sym</code> often riddle our scripts.</p>

<p>The issue is undeniably attested to by real world "solutions"
others have created to address it, such as Ruby Facets'
<a href="http://facets.rubyforge.org/doc/api/core/classes/Hash.html#M000124">Hash#rekey</a>.
and Ruby on Rails'
<a href="http://api.rubyonrails.org/classes/HashWithIndifferentAccess.html">HashWithIndifferentAccess</a>.
But let's face it, these are both underwhelming attempts at mitigating
the fundamental problem.</p>

<p>A real solution would have the current Hash class renamed, and a new
limited-key structure put in its place. The old class would still be
available, of course, for those special cases when a key of any object
type is required, but the new, more utilitarian Hash class would be
the literally-constructed default. The end effect of this change would
be simple:</p>

<div class="CodeRay">
  <div class="code"><pre>
  h[<span style="background-color:#fff0f0;color:#D20"><span style="color:#710">'</span><span style="">a</span><span style="color:#710">'</span></span>] == h[<span style="color:#A60">:a</span>]
  h[<span style="background-color:#fff0f0;color:#D20"><span style="color:#710">'</span><span style="">1</span><span style="color:#710">'</span></span>] == h[<span style="color:#00D;font-weight:bold">1</span>]

</pre></div>
</div>

<p>This means reducing all hash keys to a single <em>symbolic</em> index type.
It does not matter what the actual reference is, a String, Symbol,
Integer, etc. just so long as it has a predictable symbolic
representation.</p>

<p>It may feel a bit strange to consider a suggestion that actually calls
for the reduction of features. More often change requests call for just
the opposite and YAGNI has to be peddled out on them. But, I think, we
often underestimate the power of simplicity. Consider ideas such as
convention-over-configuration and duck-typing --simplifications that
are not necessarily intuitive at first. But in the end, they make our
life as programmers a good bit more productive.</p>

<blockquote>
"Make everything as simple as possible, but not simpler."
<cite>--Albert Einstein</cite>
</blockquote>


    </div>
    <p><a href="2008/10/hash.html">Continue Reading</a></p>
    <!-- <small>Written by Anonymous</small> -->
  </div>
  <br/>


</div>



<br/><br/>

<div style="text-align: center;">
  <script type="text/javascript"><!--
  google_ad_client = "pub-1126154564663472";
  /* RUBYWORKS 09-10-02 728x90 */
  google_ad_slot = "0788888658";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>

<br/><br/>

<div class="footer">
(c) 2002 Thomas Sawyer, All Rights Reserved. Special Thanks to Dieter Stein for the Ruby icon.
Graphic image is "Serpent" by Ruby Lee.
</div>

</body>

</div>
</html>

