
<html>

<head>
  <title>Ruby Works</title>

  <link REL="SHORTCUT ICON" HREF="../../assets/images/ruby_1.jpg" />

  <style>
    body  { font-family: arial; font-size: 11pt; margin: 0; padding: 0; background: url(../../assets/images/bg.jpg) 0 -10px repeat-x #dfdfff; }

       a  { text-decoration: none; }

       a:hover  { text-decoration: underline; }

     img  { border: none; }

      li  { font-family: monospace; font-size: 10pt; padding-bottom: 30px; }

     .nav { font-family: arial;  height: 365px; border-left: 1px solid #ccc; border-right: 1px solid #ccc; }

     .nav a { font-size: 18px; font-weight: bold; line-height: 36px; padding: 0 6px; text-decoration: none; }

   .links a { color: #aaa; font-size: 0.9em; }

   .title { font-family: arial; color: red; font-size: 28pt; height: 64px; background: url(../../assets/images/ruby_1.jpg) no-repeat; padding-left: 64px; }

   .title a { text-decoration: none; font-family: arial; color: red; font-size: 28pt; height: 64px; }

   .title .date { font-size: 20pt; }

   .footer { font-size: 10px; border-top: 1px solid #ccc; color: #999; }
  </style>
</head>

<body>

<div style="margin: 0 auto; width: 960px;">

<!-- Title -->
<div class="nav" style="background: url(../../assets/images/serpent.jpg) no-repeat; padding-left: 300px;">

  <div style="font-family: arial; font-size: 32pt; color: #ee0022;">
    <br/>
    <b>Ruby Works</b> <br/>
    <a href="../../index.html">Blog.read</a>
    <a href="../../projects.html">Self.inspect</a>
    <a href="../../rubynew.html">Ruby.new</a>
    <a href="http://github.com/rubyworks/">Github.com</a>
  </div>
   
  <div style="margin-top: 40px;">
    <FORM method="GET" action="http://www.google.com/groups" target="_blank">
    <!-- Search Google -->
    <A HREF="http://www.google.com/">
    <IMG SRC="http://www.google.com/logos/Logo_25wht.gif" border="0" ALT="Google" align="absmiddle"></A>
    <INPUT TYPE="text" name="q" size="25" maxlength="255" value="">
    <input type="hidden" name="hl" value="en">
    <input type="hidden" name="group" value="comp.lang.ruby">
    <INPUT type="submit" name="btnG" VALUE="Search Ruby Talk">
    <!-- Search Google -->
    </FORM>
  </div>

</div>

<div style="padding: 20px; background: white;">


<div class="page">

  <div class="title"><a href="">Functor</a></div>

  <h1>Functor : Object :: Enumerator : Enumerable</h1>

<p>In Ruby 1.9, Enumerable methods return an Enumerator when no block is provided them. This makes it very convenient to chain methods in what is often called <em>fluid notation</em>. For example, rather than the usual +#each_with_index+, one can use:</p>

<div class="CodeRay">
  <div class="code"><pre>
  [<span style="color:#00D;font-weight:bold">1</span>,<span style="color:#00D;font-weight:bold">2</span>,<span style="color:#00D;font-weight:bold">3</span>].each.with_index{ |e, i| ... }

</pre></div>
</div>

<p>Plenty of other possibilities along these lines become possible. It's a very powerful technique.</p>

<p>In the same spirit, I think there is another class that could be used in much the same way for more general methods, namely what Ruby Facets calls a <em>Functor</em> --a function that acts on a function. Essentially, it is defined as:</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Functor</span>
    private(*instance_methods.select { |m| m !~ <span style="background-color:#fff0ff"><span style="color:#404">/</span><span style="color:#808">(^__|^binding$)</span><span style="color:#404">/</span></span> })
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(&amp;function)
      <span style="color:#33B">@function</span> = function
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">to_proc</span>
      <span style="color:#33B">@function</span>
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">method_missing</span>(op, *args, &amp;blk)
      <span style="color:#33B">@function</span>.call(op, *args, &amp;blk)
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>An interesting example of it's use if overriding +#instance_eval+ to return a functor when no block is provided.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Object</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">instance_eval</span>(*args, &amp;blk)
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">super</span> <span style="color:#080;font-weight:bold">if</span> blk <span style="color:#080;font-weight:bold">or</span> !args.empty?
      <span style="color:#33B">@_instance_eval</span> ||= <span style="color:#036;font-weight:bold">Functor</span>.new <span style="color:#080;font-weight:bold">do</span> |op, *a, &amp;b|
        fcall(op, *a, &amp;b)
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>Now we can call a single method via instance_eval using fluid notation instead of having to open a block.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#036;font-weight:bold">MyClass</span>.instance_eval.attr_accessor <span style="color:#A60">:x</span>

</pre></div>
</div>

<p>There are many other similar uses for Functors. Just as Enumerator opens up a great deal of convenience and conciseness for Enumerable methods, Functor can do the same for methods generally.</p>


  <small>Written by trans, 2009-09-30</small>

  <ul class="posts">
    
    
  </ul>

  <script>
  var idcomments_acct = '1e97cd0a25f01bb50181e727255ddffb';
  var idcomments_post_id;
  var idcomments_post_url;
  </script>
  <span id="IDCommentsPostTitle" style="display:none"></span>
  <script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>

</div>



<br/><br/>

<div style="text-align: center;">
  <script type="text/javascript"><!--
  google_ad_client = "pub-1126154564663472";
  /* RUBYWORKS 09-10-02 728x90 */
  google_ad_slot = "0788888658";
  google_ad_width = 728;
  google_ad_height = 90;
  //-->
  </script>
  <script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>

<br/><br/>

<div class="footer">
(c) 2002 Thomas Sawyer, All Rights Reserved. Special Thanks to Dieter Stein for the Ruby icon.
Graphic image is "Serpent" by Ruby Lee.
</div>

</body>

</div>
</html>

